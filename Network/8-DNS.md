---
title: 8 DNS
date: 2018-04-17 20:52:35
category: Computer_Network
tags: [Application Layer]
---
<font size=6>域名系统
<!--more-->

---
<font size=5>域名系统 (domain name system, DNS) : 
<font size=3>TCP/IP使用IP地址来身份认证一个实体。但是人们比起地址更喜欢使用名字。所以需要一个目录系统将名字映射到地址。这个目录系统就是DNS。

接下来我们将使用FTP协议来介绍DNS协议是如何工作的 : 
1. 用户将FTP服务器主机名发给FTP客户机。
2. FTP客户机将FTP服务器主机名发给DNS客户机。
3. 每台计算机在启动后都知道DNS服务器的地址，DNS客户机向DNS服务器请求询问FTP服务器主机名的IP地址。
4. DNS服务器返回FTP服务器的IP地址。
5. DNS客户机将IP地址给FTP客户机。
6. FTP客户机使用IP地址与FTP服务器连接。

上面这个过程中我们可以看到，我们所期望的只有FTP客户机与服务器的连接，但在此之前还需要DNS客户机有服务器的连接。在这种情况下，至少需要两次连接，一次用于主机名和IP地址的映射，一次用于协议连接。

每一个主机名必须是独一无二的，因为其对于的IP地址是独一无二的。一个命名空间 (name space) 有两种方式 : 
- 平行化 (flat) : 命名是没有任何结构的一串字符串。可以与其他命名有相同的部分。这种方式的缺点就是无法用于大型系统，因为需要集中控制防止模糊和重复。
- 层次化 (hierachial) : 这种方式的命名被分为几部分，每个部分在不同的层。在分配和管理命名空间可以做到去中心化。

域命名空间是层次化实现的，是一棵有着根节点的树。这棵树只能有128层，从第0层 (root) 到第127层。在这棵树的每一个节点都有一个标签 (label)，标签是最大63个字符的字符串，根的标签是一个空字符串。同一层的标签不能有同一个标签。每个节点都有其域名，其域名为从该节点往上到达根的标签序列，每个标签用.分开。因为根节点是空字符串，所以完整域名的最后一个字符是.。比如 dept.university.edu.

域 (domain) 是域命名空间的一个子树，这个域的命名就是该子树的根的命名。

域命名空间过于庞大。使用一台计算机进行存储则会效率低下，也是不现实的。所以将域命名空间分布式存储在许多计算机中，这些计算机叫做DNS服务器。我们将域命名空间的根独立出来，将第1层划分为许多个域。这些域可以被接着划分。所以DNS服务器也是层次化的。

区 (zone) 在一个域没有被划分为其他更小的域时和域是相同的，但若被划分更小的域时，区包含这个服务器的信息和子域的引用。

DNS服务器的类型有这些 : 
- 根DNS服务器 (root DNS server) : 最顶级的DNS服务器。目前共13个根服务器，但因为根服务器是一个冗余服务器，所以目前有247个根服务器。
- 顶级域DNS服务器 (top-level DNS server) : 这些服务器负责顶级域名如com, org, net, edu和uk, fr, jp, cn这些国家顶级域名。
- 权威DNS服务器 (Authoritative DNS server) : 在Internet上具有公共可访问主机的组织机构提供公共可访问的DNS记录,权威DNS服务器收藏这些记录。
- 本地DNS服务器 (local DNS server) : 每一个ISP都有一台本地DNS服务器。当主机与ISP连接时，ISP提供给主机IP地址。

DNS服务器还分为主要服务器和次要服务器。主要服务器存储这个服务器的区。次要服务器将其他的服务器的区进行存储。当主要服务器出现问题，次要服务器能继续服务。

将命名映射到地址被称为解析。DNS客户机被称为解析器 (resolver)。解析器访问最近的DNS服务器，如果服务器有对应信息，则返回信息。否则，就进行其他的解析 (接下来进行介绍)。在解析器得到映射后，对回应进行解释查看是解析还是错误，最后发给请求解析的程序。解析有两种 : 
- 递归解析 (recursive resolution) : 我们假设A想得到B的IP地址。A先访问本地DNS服务器，若未找到信息。则访问根服务器，根服务器一般不会保存映射信息，但它知道C服务器拥有信息，则根服务器向C服务器请求信息。直到找到B的IP地址，再把IP地址原路返回给A的本地DNS服务器。
- 迭代解析 (iterative resolution) : 继续假设A想得到B的IP地址。A先访问本地DNS服务器，若未找到信息。则访问根服务器，根服务器没有映射信息，但返回A的本地DNS服务器一个回应。回应的内容并不是B的IP地址，而是C服务器的地址，因为C知道B的地址。A的本地DNS服务器又向C请求B的IP地址。直到找到B的IP地址，将IP地址直接返回给A的本地DNS服务器。

每次DNS服务器接收请求获得不再其域内的命名的IP地址时，都需要向其他DNS服务器寻求解析。减少这个过程的时间就至关重要。DNS解决这个问题使用了缓存 (cache) 的技术。当服务器向其他服务器发送请求并返回回应，在发给客户机前都会将信息存入内存中。这样，在得到同一个命名映射请求时就可以从缓存中获得信息返回给客户机。这个信息被标明是从缓存中发出而不是权威源发出，也就是非权威的 (unauthoritative)。

DNS服务器使用缓存加快了解析的速度但是也引发了一个问题。那就是如果一个信息缓存了很久，可能会返回一个过时的映射给客户机。解决这个问题使用了两种技术。第一种就是给每条信息加上留存时间 (time to live, TTL),TTL是该信息所能被缓存的秒。一但缓存时间超过TTL，该信息就是无效的，对该信息的查询只能再次从权威服务器中获取。第二种就是每个服务器对每一条缓存的映射使用TTL计数器，缓存必须被周期性的搜索，过时的映射都将被清理。

DNS资源记录和报文可以查询RFC文档。

增加，删除，更新信息需要更改DNS主文件。在今日，手动管理主文件是不可行的。动态域名系统 (dynamic domain name system, DDNS) 因此被设计于自动更新主文件。当新的信息被DHCP (之后讨论) 发送给主要服务器。主要服务器更新其区。次要服务器被主动或被动通知。在主动情况下，主要服务器向次要服务器发送报文。被动情况下，次要服务器周期性检查改动。